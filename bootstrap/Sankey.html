<!DOCTYPE html>
<html>
<head>
	<title>Sankey Chart</title>
	<script src="lib/js/d3.v4.js"></script>
	<script src="lib/js/d3-sankey.min.js"></script>
</head>
<body>
<p id="chart">

	<script type="text/javascript">

		var margin = {top: 10, right: 10, bottom: 10, left: 10},
		    width = 700 - margin.left - margin.right,
		    height = 300 - margin.top - margin.bottom;

		var data = {
		  'nodes': [
		    {name: "all"},
		    {name: "male"},
		    {name: "female"},
		    {name: "1"},
		    {name: "2"},
		    {name: "3"},
		    {name: "4"},
		    {name: "5"},
		    {name: "6"}
		    {name: "7_8"}
		  ],
		  'links': [
		    {source: 0, target: 1, value: 10},
		    {source: 1, target: 2, value: 10},
		    {source: 2, target: 4, value: 5},
		    {source: 1, target: 5, value: 5},
		    {source: 3, target: 6, value: 5},
		    {source: 3, target: 7, value: 5},
		    {source: 4, target: 7, value: 10},
		    {source: 4, target: 8, value: 5},
		    {source: 5, target: 8, value: 5}
		  ],
		};
	  	var color=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"];

		var svg = d3.select("#chart").append("svg")
		    .attr("width", width + margin.left + margin.right)
		    .attr("height", height + margin.top + margin.bottom)
			.append("g")
		    .attr("transform", 
		          "translate(" + margin.left + "," + margin.top + ")");

		var sankey = d3.sankey()
	        .nodeWidth(20) 
	        .nodePadding(40) 
	        .size([width, height]) 
	        .nodes(data.nodes)  
	        .links(data.links)
	        .layout(32);

	    var path = sankey.link();


	    var links = svg.append("g").selectAll("path")
            .data(data.links)
            .enter()

		 var link = svg.append("g").selectAll(".link")
			.data(links)
			.enter().append("path")
			.attr("class", "link")
			.attr("d", path)
			.style("stroke-width", function(d) { return Math.max(1, d.dy); })
			.style("stroke", function(d) { return d.source.color = color(d.source.name.replace(/ .*/, "")); })

        var nodes = svg.append("g").selectAll(".node")
                .data(data.nodes)
                .enter();

		links.append("path")
			.attr("fill", "none")   //填充色
			.attr("stroke","#41b6c4")
				// function(d,i){ 
				// return color(i);})
			.attr("stroke-opacity",0.5)
			.attr("d", path)
			.attr("id",function(d,i){ 
				return 'link' +i })
			.style("stroke-width", function (d) {  //连线的宽度
				return Math.max(1, d.dy);
			});

		nodes.append("rect")
			.attr("height", sankey.nodeWidth())
			.attr("width", function(d) { return d.dy; })
			.style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
			.style("stroke", function(d) { return d3.rgb(d.color).darker(2); })

		// nodes.append("rect")
		//     .attr("transform",function (d) {
		//           return "translate(" + d.x + "," + d.y + ")";
		//        })
	 //        .attr("r", function(d) { return d.dy / 2; })
	 //        .attr("cx", function(d) { return d.dx/2; })
	 //        .attr("cy", function(d) { return d.dy / 2; })
	 //        .style("fill", "tomato")
	 //        .style("stroke", "gray");




	</script>
</body>
</html>